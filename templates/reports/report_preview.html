{% extends 'base.html' %}

{% block title %}Report Preview - RoadHealth AI{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto fade-in">
  <!-- Header -->
  <div class="bg-white rounded-lg shadow-md p-8 mb-6">
    <div class="flex justify-between items-center mb-6">
      <div>
        <h1 class="text-3xl font-bold text-gray-800">
          Road Condition Analysis Report
        </h1>
        <p class="text-gray-600 mt-2">
          Report ID: RH-{{ image.id|stringformat:"06d" }}
        </p>
      </div>
      <div class="text-right">
        <p class="text-sm text-gray-600">Generated:</p>
        <p class="font-medium">{{ "now"|date:"M d, Y H:i" }}</p>
      </div>
    </div>

    <div class="flex space-x-4">
      <a
        href="{% url 'generate_report' image.id %}"
        class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition"
      >
        <i class="fas fa-download mr-2"></i> Download PDF
      </a>
      <a
        href="{% url 'image_detail' image.id %}"
        class="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400 transition"
      >
        <i class="fas fa-arrow-left mr-2"></i> Back to Details
      </a>
    </div>
  </div>

  <!-- Image Information -->
  <div class="bg-white rounded-lg shadow-md p-8 mb-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-4">Image Information</h2>
    <div class="grid grid-cols-2 gap-4">
      <div>
        <p class="text-sm text-gray-600">Uploaded By</p>
        <p class="font-medium">
          {{ image.user.get_full_name|default:image.user.email }}
        </p>
      </div>
      <div>
        <p class="text-sm text-gray-600">Upload Date</p>
        <p class="font-medium">{{ image.upload_date|date:"M d, Y H:i" }}</p>
      </div>
      <div>
        <p class="text-sm text-gray-600">Title</p>
        <p class="font-medium">{{ image.title|default:"N/A" }}</p>
      </div>
      <div>
        <p class="text-sm text-gray-600">Location</p>
        <p class="font-medium">{{ image.location_name|default:"N/A" }}</p>
      </div>
    </div>
  </div>

  <!-- Analysis Results -->
  <div class="bg-white rounded-lg shadow-md p-8 mb-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-4">Analysis Results</h2>
    <div class="grid grid-cols-2 gap-4 mb-6">
      <div class="bg-gray-50 p-4 rounded">
        <p class="text-sm text-gray-600">Defect Type</p>
        <p class="text-xl font-bold text-blue-600">
          {{ analysis.get_defect_type_display }}
        </p>
      </div>
      <div class="bg-gray-50 p-4 rounded">
        <p class="text-sm text-gray-600">Severity Score</p>
        <p class="text-xl font-bold">
          {{ analysis.severity_score|floatformat:2 }} / 100
        </p>
      </div>
      <div class="bg-gray-50 p-4 rounded">
        <p class="text-sm text-gray-600">Condition</p>
        <p
          class="text-xl font-bold {% if analysis.condition_label == 'critical' %}text-red-600 {% elif analysis.condition_label == 'poor' %}text-orange-600 {% elif analysis.condition_label == 'moderate' %}text-yellow-600 {% else %}text-green-600{% endif %}"
        >
          {{ analysis.get_condition_label_display }}
        </p>
      </div>
      <div class="bg-gray-50 p-4 rounded">
        <p class="text-sm text-gray-600">AI Confidence</p>
        <p class="text-xl font-bold">
          {{ analysis.ai_confidence|floatformat:2|multiply:100 }}%
        </p>
      </div>
    </div>

    <div class="border-t pt-4">
      <h3 class="font-bold text-gray-800 mb-2">Model Information</h3>
      <p class="text-sm text-gray-600">
        {{ analysis.model_name }} v{{ analysis.model_version }}
      </p>
      <p class="text-sm text-gray-600">
        Analysis Date: {{ analysis.analyzed_at|date:"M d, Y H:i" }}
      </p>
    </div>
  </div>

  <!-- Maintenance Recommendation -->
  <div class="bg-white rounded-lg shadow-md p-8 mb-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-4">
      <i class="fas fa-tools mr-2"></i> Maintenance Recommendation
    </h2>
    <div class="bg-blue-50 p-6 rounded-lg">
      <p class="text-gray-800">{{ analysis.maintenance_suggestion }}</p>
    </div>
  </div>

  <!-- Images -->
  <div class="bg-white rounded-lg shadow-md p-8">
    <h2 class="text-2xl font-bold text-gray-800 mb-4">Images</h2>
    <div
      class="grid grid-cols-1 {% if analysis.annotated_image %}md:grid-cols-2{% endif %} gap-6"
    >
      <div>
        <h3 class="font-semibold text-gray-700 mb-2">Original Image</h3>
        <img
          src="{{ image.image.url }}"
          alt="Original"
          class="w-full rounded-lg shadow"
        />
      </div>
      {% if analysis.annotated_image %}
      <div>
        <h3 class="font-semibold text-gray-700 mb-2">Annotated Analysis</h3>
        <img
          src="{{ analysis.annotated_image.url }}"
          alt="Annotated"
          class="w-full rounded-lg shadow"
        />
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Footer -->
  <div
    class="bg-gray-100 rounded-lg p-6 mt-6 text-center text-sm text-gray-600"
  >
    <p class="font-semibold">
      RoadHealth AI - Automated Pavement Condition Assessment
    </p>
    <p class="mt-2">
      This report is generated automatically by AI analysis and should be
      reviewed by qualified engineers.
    </p>
    <p class="mt-2">
      For questions or concerns, please contact your system administrator.
    </p>
  </div>
</div>
{% endblock %}
